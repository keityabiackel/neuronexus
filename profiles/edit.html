<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Perfil Â· NeuroNexus</title>
<link rel="stylesheet" href="../assets/app.css" />
</head>

<body>
<main class="wrap">
  <h2>Perfil Neurodivergente</h2>

  <!-- DADOS BÃSICOS -->
  <section class="card">
    <div class="grid2">
      <div class="field">
        <label>Nome</label>
        <input id="name" />
      </div>
      <div class="field">
        <label>Data de nascimento</label>
        <input id="birthDate" type="date" />
      </div>
    </div>
  </section>

  <!-- CAMADA 1 -->
  <section class="card">
    <h3>ğŸ§  Neurotipo-base</h3>
    <select id="baseType"></select>

    <label>Status</label>
    <select id="baseStatus">
      <option value="confirmado">Confirmado</option>
      <option value="suspeita">Suspeita / Em avaliaÃ§Ã£o</option>
    </select>
  </section>

  <!-- CAMADA 2 -->
  <section class="card">
    <h3>ğŸ§© Perfis neurocognitivos associados</h3>
    <div id="layer2"></div>
  </section>

  <!-- CAMADA 3 -->
  <section class="card">
    <h3>ğŸ§  CondiÃ§Ãµes neurolÃ³gicas associadas</h3>
    <div id="layer3"></div>
  </section>

  <!-- CAMADA 4 -->
  <section class="card">
    <h3>ğŸ§  CondiÃ§Ãµes psiquiÃ¡tricas associadas</h3>
    <div id="layer4"></div>
  </section>

  <!-- SUPORTE -->
  <section class="card">
    <h3>NÃ­vel atual de suporte</h3>
    <select id="support">
      <option value="nao_informado">NÃ£o informado</option>
      <option value="baixo">Baixo</option>
      <option value="moderado">Moderado</option>
      <option value="alto">Alto</option>
      <option value="flutuante">Flutuante</option>
    </select>

    <label>ObservaÃ§Ãµes funcionais</label>
    <input id="observations" />
  </section>

  <button class="btn primary" id="save">Salvar perfil</button>
</main>

<script type="module">
import {
  NEURO_TAXONOMY,
  defaultPerson,
  upsertPerson
} from "../assets/app.js";

const person = defaultPerson();

const baseSelect = document.getElementById("baseType");
NEURO_TAXONOMY.layer1_base.forEach(k=>{
  const o = document.createElement("option");
  o.value = k;
  o.textContent = k.replaceAll("_"," ");
  baseSelect.appendChild(o);
});

function renderList(container, items){
  items.forEach(k=>{
    const label = document.createElement("label");
    label.innerHTML = `<input type="checkbox" value="${k}"> ${k.replaceAll("_"," ")}`;
    container.appendChild(label);
  });
}

renderList(document.getElementById("layer3"), NEURO_TAXONOMY.layer3_neurologic);
renderList(document.getElementById("layer4"), NEURO_TAXONOMY.layer4_psychiatric);

Object.values(NEURO_TAXONOMY.layer2_profiles).forEach(group=>{
  renderList(document.getElementById("layer2"), group);
});

document.getElementById("save").onclick = ()=>{
  person.name = name.value;
  person.birthDate = birthDate.value;
  person.neuroProfile.base = baseType.value;
  person.neuroProfile.baseStatus = baseStatus.value;
  person.neuroProfile.supportLevel = support.value;
  person.neuroProfile.observations = observations.value;

  person.neuroProfile.neurologic =
    [...document.querySelectorAll("#layer3 input:checked")].map(x=>x.value);
  person.neuroProfile.psychiatric =
    [...document.querySelectorAll("#layer4 input:checked")].map(x=>x.value);

  upsertPerson(person);
  alert("Perfil salvo.");
};
</script>
</body>
</html>
