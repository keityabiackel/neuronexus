<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pessoas Â· NeuroNexus</title>
<link rel="stylesheet" href="../assets/app.css" />
</head>
<body>
<main class="wrap">
  <header class="header">
    <div class="brandline">
      <div class="brandtext">
        <h1>NEURONEXUS</h1>
        <p>Pessoas Â· perfis Ãºnicos</p>
      </div>
    </div>
    <nav class="nav">
      <a class="btn" href="../index.html">ğŸ  Estado da Casa</a>
      <a class="btn" href="../clans/index.html">ğŸ¡ ClÃ£s</a>
      <a class="btn primary" href="./edit.html">â• Novo perfil</a>
    </nav>
  </header>

  <section class="card">
    <h2>Perfis cadastrados</h2>
    <div class="profilesTableWrap">
    <table class="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Nascimento</th>
          <th>Neurotipo-base</th>
          <th>Atualizado</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
      </div>
    <div id="profilesCards" class="profilesCards" aria-label="Perfis cadastrados em formato de cartÃµes"></div>
    <p class="small">Dica: uma pessoa pode participar de vÃ¡rios clÃ£s sem recadastrar.</p>
  </section>
</main>

<script type="module">
import { loadPersons, deletePerson } from "../assets/app.js";

const rows = document.getElementById("rows");
const persons = loadPersons();

function baseLabel(p){
  const arr = (p.neuro?.baseTypes || []).slice();
  if(!arr.length) return "â€”";
  return arr.join(", ");
}

rows.innerHTML = "";
persons.forEach(p=>{
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${p.name || "â€”"}</td>
    <td>${p.birthDate || "â€”"}</td>
    <td>${baseLabel(p)}</td>
    <td>${(p.updatedAt || "â€”").replace("T"," ").slice(0,19)}</td>
    <td class="actions">
      <a class="btn" href="./edit.html?id=${encodeURIComponent(p.id)}">Editar</a>
      <button class="btn danger" data-del="${p.id}">Excluir</button>
    </td>
  `;
  rows.appendChild(tr);
});

document.querySelectorAll("[data-del]").forEach(b=>{
  b.onclick = ()=>{
    if(confirm("Excluir esta pessoa? (isso remove ela de todos os clÃ£s)")){
      deletePerson(b.dataset.del);
      location.reload();
    }
  };
});
</script>
</body>
</html>
