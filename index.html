<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NeuroNexus Â· Estado da Casa</title>
  <link rel="stylesheet" href="./assets/app.css" />
</head>

<body>
<main class="wrap">
  <header class="header">
    <div class="brandline">
      <div class="brandtext">
        <h1>NEURONEXUS</h1>
        <p>MVP Fase 0 Â· sem backend</p>
      </div>
    </div>

    <nav class="nav">
      <a class="btn" href="./clans/index.html">ğŸ¡ ClÃ£s</a>
      <a class="btn" href="./profiles/index.html">ğŸ‘¥ Membros do clÃ£</a>
    </nav>
  </header>

  <!-- CARD: ESTADO -->
  <section class="card" id="houseCard">
    <h2>Estado da Casa</h2>
    <p class="muted">Um indicador compartilhado e acionÃ¡vel do estado do ambiente domÃ©stico. Menos interpretaÃ§Ã£o; mais dados observÃ¡veis.</p>

    <div class="rowBetween">
      <div class="badgeLine">
        <span class="dot" id="dot"></span>
        <span class="stamp" id="stamp">///</span>
        <strong id="stateText">Estado: â€”</strong>
      </div>
      <div class="small">
        <div>Atualizado em: <span id="updatedAt">â€”</span></div>
        <div>ClÃ£: <span id="clanName">â€”</span></div>
      </div>
    </div>

    <div class="btnRow">
      <button class="btn" id="btnGreen">ğŸŸ¢ VERDE</button>
      <button class="btn" id="btnYellow">ğŸŸ¡ AMARELO</button>
      <button class="btn" id="btnRed">ğŸ”´ VERMELHO</button>
      <button class="btn danger" id="btnClear">Limpar estado</button>
    </div>

    <p class="small">
      Acessibilidade: alÃ©m de cor, cada estado tem uma â€œestampaâ€ (pontilhado / listras / hatch) + texto + Ã­cone.
      Atalhos: 1 (Verde), 2 (Amarelo), 3 (Vermelho).
    </p>

    <p class="small">
      Este MVP salva no seu navegador (LocalStorage). Enquanto vocÃª nÃ£o cria um ClÃ£, o estado fica em â€œSem clÃ£â€.
      Depois, ele passa a funcionar por ClÃ£ automaticamente.
    </p>
  </section>

  <!-- CARD: EVIDÃŠNCIA -->
  <section class="card">
    <h2>Do semÃ¡foro para a evidÃªncia</h2>
    <p class="muted">
      Ã€s vezes a gente nÃ£o â€œdefineâ€ o estado â€” a gente <strong>descobre</strong>.
      PrÃ³ximo passo: sinais observÃ¡veis (sono, ingestÃ£o, dor, estÃ­mulo, rotina, episÃ³dios com timestamp)
      para sugerir o estado com base em evidÃªncias.
    </p>
  </section>

  <!-- NOVO CARD: NÃƒO ENTENDI NADA -->
  <section class="card">
    <h2>NÃ£o entendi nada!</h2>
    <p class="muted">Escolha o nÃ­vel de ajuda que vocÃª quer agora.</p>

    <div class="btnRow two">
      <a class="btn primary" href="./help/resumo.html">me faz um resumo</a>
      <a class="btn" href="./help/explicacao.html">me explique direito</a>
    </div>
  </section>

</main>

<script type="module">
import {
  loadClans,
  loadActiveClanId,
  setActiveClanId,
  loadHouse,
  saveHouse,
  clearHouse,
  formatWhen
} from "./assets/app.js";

const $ = (id)=>document.getElementById(id);

function getActiveClan(){
  const clans = loadClans();
  if(!clans.length) return null;

  let activeId = loadActiveClanId();
  let active = clans.find(c=>c.id===activeId) || clans[0];
  setActiveClanId(active.id);
  return active;
}

function applyTheme(state){
  // Estado + estampa (acessÃ­vel)
  const body = document.body;
  body.classList.remove("bg-green","bg-yellow","bg-red","bg-none");

  const dot = $("dot");
  const stamp = $("stamp");

  dot.className = "dot";
  stamp.textContent = "///";

  if(state === "GREEN"){
    body.classList.add("bg-green");
    dot.classList.add("green");
    stamp.textContent = "Â·Â·Â·";
  }else if(state === "YELLOW"){
    body.classList.add("bg-yellow");
    dot.classList.add("yellow");
    stamp.textContent = "///";
  }else if(state === "RED"){
    body.classList.add("bg-red");
    dot.classList.add("red");
    stamp.textContent = "###";
  }else{
    body.classList.add("bg-none");
    dot.classList.add("none");
    stamp.textContent = "â€”";
  }
}

function render(){
  const active = getActiveClan();
  const clanId = active ? active.id : "";
  $("clanName").textContent = active ? active.name : "Sem clÃ£";

  const h = loadHouse(clanId);
  const state = h?.state || null;

  $("stateText").textContent = `Estado: ${state === "GREEN" ? "VERDE" : state === "YELLOW" ? "AMARELO" : state === "RED" ? "VERMELHO" : "â€”"}`;
  $("updatedAt").textContent = h?.updatedAt ? formatWhen(h.updatedAt) : "â€”";

  applyTheme(state);
}

function setState(s){
  const active = getActiveClan();
  const clanId = active ? active.id : "";
  saveHouse(s, clanId);
  render();
}

$("btnGreen").onclick = ()=>setState("GREEN");
$("btnYellow").onclick = ()=>setState("YELLOW");
$("btnRed").onclick = ()=>setState("RED");
$("btnClear").onclick = ()=>{
  const active = getActiveClan();
  const clanId = active ? active.id : "";
  clearHouse(clanId);
  render();
};

document.addEventListener("keydown", (e)=>{
  if(e.key==="1") setState("GREEN");
  if(e.key==="2") setState("YELLOW");
  if(e.key==="3") setState("RED");
});

render();
</script>
</body>
</html>
